var XHR,CoMail;(function(n){var t=function(){function n(n){var r,i,t;for(this.Mailbox="",this.Page=1,this.EmailId=-1,this.Subject="",this.From="",r=n.split("&"),i=0;i<r.length;i++){t=r[i].split("=");switch(t[0].toLowerCase()){case"mailbox":this.Mailbox=t[1];break;case"page":this.Page=parseInt(t[1]);break;case"emailid":this.EmailId=parseInt(t[1]);break;case"from":this.From=t[1];break;case"subject":this.Subject=t[1]}}}return n.prototype.AddEmailId=function(n){var t="";return this.Mailbox.length>0&&(t+="&mailbox="+this.Mailbox),this.Page>-1&&(t+="&page="+this.Page.toString()),this.Subject.length>0&&(t+="&subject="+this.Subject),this.From.length>0&&(t+="&from="+this.From),t+="&emailid="+n.toString(),t.substring(1)},n.prototype.RemoveEmailId=function(){var n="";return this.Mailbox.length>0&&(n+="&mailbox="+this.Mailbox),this.Page>-1&&(n+="&page="+this.Page.toString()),this.Subject.length>0&&(n+="&subject="+this.Subject),this.From.length>0&&(n+="&from="+this.From),n.substring(1)},n}();n.LocationHash=t})(CoMail||(CoMail={})),function(n){var t=function(){function n(){}return n.prototype.Get=function(){var n=XHR.Get("API/MailBoxes");return new Promise(function(t,i){n.then(function(n){var i=JSON.parse(n.Text);return t(i)}).catch(function(){return console.log("error in GetMailBoxes"),i(null)})})},n}();n.PublicMailBox=t}(CoMail||(CoMail={}));
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/jakearchibald/es6-promise/master/LICENSE
 * @version   3.2.2+35df15ea
 */
(function(){"use strict";function dt(n){return"function"==typeof n||"object"==typeof n&&null!==n}function rt(n){return"function"==typeof n}function gt(n){k=n}function ni(n){r=n}function ti(){return function(){process.nextTick(u)}}function ii(){return function(){lt(u)}}function ri(){var n=0,i=new wt(u),t=document.createTextNode("");return i.observe(t,{characterData:!0}),function(){t.data=n=++n%2}}function ui(){var n=new MessageChannel;return n.port1.onmessage=u,function(){n.port2.postMessage(0)}}function ut(){return function(){setTimeout(u,1)}}function u(){for(var t,i,n=0;e>n;n+=2)t=o[n],i=o[n+1],t(i),o[n]=void 0,o[n+1]=void 0;e=0}function fi(){try{var t=require,n=t("vertx");return lt=n.runOnLoop||n.runOnContext,ii()}catch(i){return ut()}}function ei(n,t){var e=this,i=new this.constructor(f),u,o;return void 0===i[v]&&ht(i),u=e._state,u?(o=arguments[u-1],r(function(){st(u,i,o,e._result)})):w(e,i,n,t),i}function oi(n){var i=this,t;return n&&"object"==typeof n&&n.constructor===i?n:(t=new i(f),c(t,n),t)}function f(){}function si(){return new TypeError("You cannot resolve a promise with itself")}function hi(){return new TypeError("A promises callback cannot return that same promise.")}function ft(n){try{return n.then}catch(t){return y.error=t,y}}function ci(n,t,i,r){try{n.call(t,i,r)}catch(u){return u}}function li(t,u,f){r(function(t){var r=!1,e=ci(f,u,function(n){r||(r=!0,u!==n?c(t,n):i(t,n))},function(i){r||(r=!0,n(t,i))},"Settle: "+(t._label||" unknown promise"));!r&&e&&(r=!0,n(t,e))},t)}function ai(t,r){r._state===a?i(t,r._result):r._state===h?n(t,r._result):w(r,void 0,function(n){c(t,n)},function(i){n(t,i)})}function et(t,r,u){r.constructor===t.constructor&&u===d&&constructor.resolve===g?ai(t,r):u===y?n(t,y.error):void 0===u?i(t,r):rt(u)?li(t,r,u):i(t,r)}function c(t,r){t===r?n(t,si()):dt(r)?et(t,r,ft(r)):i(t,r)}function vi(n){n._onerror&&n._onerror(n._result);b(n)}function i(n,t){n._state===s&&(n._result=t,n._state=a,0!==n._subscribers.length&&r(b,n))}function n(n,t){n._state===s&&(n._state=h,n._result=t,r(vi,n))}function w(n,t,i,u){var f=n._subscribers,e=f.length;n._onerror=null;f[e]=t;f[e+a]=i;f[e+h]=u;0===e&&n._state&&r(b,n)}function b(n){var i=n._subscribers,e=n._state,r,u,f,t;if(0!==i.length){for(f=n._result,t=0;t<i.length;t+=3)r=i[t],u=i[t+e],r?st(e,r,u,f):u(f);n._subscribers.length=0}}function ot(){this.error=null}function yi(n,t){try{return n(t)}catch(i){return nt.error=i,nt}}function st(t,r,u,f){var e,l,o,v,y=rt(u);if(y){if(e=yi(u,f),e===nt?(v=!0,l=e.error,e=null):o=!0,r===e)return void n(r,hi())}else e=f,o=!0;r._state!==s||(y&&o?c(r,e):v?n(r,l):t===a?i(r,e):t===h&&n(r,e))}function pi(t,i){try{i(function(n){c(t,n)},function(i){n(t,i)})}catch(r){n(t,r)}}function wi(){return bt++}function ht(n){n[v]=bt++;n._state=void 0;n._result=void 0;n._subscribers=[]}function bi(n){return new kt(this,n).promise}function ki(n){var t=this;return new t(vt(n)?function(i,r){for(var f=n.length,u=0;f>u;u++)t.resolve(n[u]).then(i,r)}:function(n,t){t(new TypeError("You must pass an array to race."))})}function di(t){var r=this,i=new r(f);return n(i,t),i}function gi(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");}function nr(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");}function t(n){this[v]=wi();this._result=this._state=void 0;this._subscribers=[];f!==n&&("function"!=typeof n&&gi(),this instanceof t?pi(this,n):nr())}function l(t,r){this._instanceConstructor=t;this.promise=new t(f);this.promise[v]||ht(this.promise);vt(r)?(this._input=r,this.length=r.length,this._remaining=r.length,this._result=new Array(this.length),0===this.length?i(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&i(this.promise,this._result))):n(this.promise,tr())}function tr(){return new Error("Array Methods must be provided an Array")}function ir(){var n,t;if("undefined"!=typeof global)n=global;else if("undefined"!=typeof self)n=self;else try{n=Function("return this")()}catch(i){throw new Error("polyfill failed because global object is unavailable in this environment");}t=n.Promise;(!t||"[object Promise]"!==Object.prototype.toString.call(t.resolve())||t.cast)&&(n.Promise=tt)}var ct,kt,it,p;ct=Array.isArray?Array.isArray:function(n){return"[object Array]"===Object.prototype.toString.call(n)};var lt,k,at,vt=ct,e=0,r=function(n,t){o[e]=n;o[e+1]=t;e+=2;2===e&&(k?k(u):at())},yt="undefined"!=typeof window?window:void 0,pt=yt||{},wt=pt.MutationObserver||pt.WebKitMutationObserver,rr="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),ur="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,o=new Array(1e3);at=rr?ti():wt?ri():ur?ui():void 0===yt&&"function"==typeof require?fi():ut();var d=ei,g=oi,v=Math.random().toString(36).substring(16),s=void 0,a=1,h=2,y=new ot,nt=new ot,bt=0,fr=bi,er=ki,or=di,tt=t;t.all=fr;t.race=er;t.resolve=g;t.reject=or;t._setScheduler=gt;t._setAsap=ni;t._asap=r;t.prototype={constructor:t,then:d,"catch":function(n){return this.then(null,n)}};kt=l;l.prototype._enumerate=function(){for(var t=this.length,i=this._input,n=0;this._state===s&&t>n;n++)this._eachEntry(i[n],n)};l.prototype._eachEntry=function(n,t){var i=this._instanceConstructor,e=i.resolve,r,u;e===g?(r=ft(n),r===d&&n._state!==s?this._settledAt(n._state,t,n._result):"function"!=typeof r?(this._remaining--,this._result[t]=n):i===tt?(u=new i(f),et(u,n,r),this._willSettleAt(u,t)):this._willSettleAt(new i(function(t){t(n)}),t)):this._willSettleAt(e(n),t)};l.prototype._settledAt=function(t,r,u){var f=this.promise;f._state===s&&(this._remaining--,t===h?n(f,u):this._result[r]=u);0===this._remaining&&i(f,this._result)};l.prototype._willSettleAt=function(n,t){var i=this;w(n,void 0,function(n){i._settledAt(a,t,n)},function(n){i._settledAt(h,t,n)})};it=ir;p={Promise:tt,polyfill:it};"function"==typeof define&&define.amd?define(function(){return p}):"undefined"!=typeof module&&module.exports?module.exports=p:"undefined"!=typeof this&&(this.ES6Promise=p);it()}).call(this),function(n){var t=function(){function t(){}return t.prototype.Constructor=function(){},t.prototype.Get=function(n){var t=XHR.Get("API/Email/"+n.toString());return new Promise(function(n,i){t.then(function(t){var i=JSON.parse(t.Text);return n(i)}).catch(function(){return console.log("error in Get Email"),i(null)})})},t.prototype.GetList=function(n){var u;if(this.CheckMailbox(n.Mailbox)){var r=n.Subject.length===0?"":"subject="+n.Subject,i=n.From.length===0?"":"from="+n.From,t="";return r.length>0&&(t="?"+r),i.length>0&&(t=t.length===0?"?"+i:t+"&"+i),u=XHR.Get("API/EmailList/"+n.Mailbox+"/"+(n.Page-1)+"/"+t),new Promise(function(n,t){u.then(function(t){var i=JSON.parse(t.Text);return n(i)}).catch(function(){return console.log("error in Get EmailList"),t(null)})})}},t.prototype.GetCount=function(n){var u;if(this.CheckMailbox(n.Mailbox)){var r=n.Subject.length===0?"":"subject="+n.Subject,i=n.From.length===0?"":"from="+n.From,t="";return r.length>0&&(t="&"+r),i.length>0&&(t=t.length===0?"&"+i:t+"&"+i),u=XHR.Get("API/EmailCount/?mailbox="+n.Mailbox+t),new Promise(function(n,t){u.then(function(t){var i=JSON.parse(t.Text);return n(i)}).catch(function(){return console.log("error in Get EmailCount"),t(null)})})}},t.prototype.CheckMailbox=function(t){var i=n.mailboxes.filter(function(n){return n.MailboxName===t});return i.length===1},t}();n.Email=t}(CoMail||(CoMail={})),function(n){function u(n){var t=new r;return t.Headers=n.getAllResponseHeaders(),t.Text=n.responseText,t.Type=n.responseType,t.Status=n.status,t.StatusText=n.statusText,t}function t(n,t,i,r){return r===void 0&&(r=""),new Promise(function(f,e){var o=new XMLHttpRequest;o.open(n,t);i!=null&&i.forEach(function(n){return o.setRequestHeader(n.header,n.data)});o.onload=function(){(o.status<200||o.status>=300)&&e(u(o));f(u(o))};o.onerror=function(){e("There was an error communicating with the server.  Please check your connection and try again.")};r.length>0?o.send(r):o.send()})}function i(t){return t===null?t=[new n.Header("Content-Type","application/json; charset=utf-8"),new n.Header("Accept","application/json")]:(t.push(new n.Header("Content-Type","application/json; charset=utf-8")),t.push(new n.Header("Accept","application/json"))),t}function e(n,r,u){return r===void 0&&(r=null),u===void 0&&(u=!0),r=u?i(r):r,t("GET",n,r)}function o(n,r,u,f){return r===void 0&&(r=""),u===void 0&&(u=null),f===void 0&&(f=!0),u=f?i(u):u,t("POST",n,u,r)}function s(n,r,u,f){return r===void 0&&(r=""),u===void 0&&(u=null),f===void 0&&(f=!0),u=f?i(u):u,t("PUT",n,u,r)}function h(n,r,u,f){return r===void 0&&(r=""),u===void 0&&(u=null),f===void 0&&(f=!0),u=f?i(u):u,t("DELETE",n,u,r)}var f=function(){function n(n,t){this.header=n;this.data=t}return n}(),r;n.Header=f;r=function(){function n(){}return n}();n.Data=r;n.Get=e;n.Post=o;n.Put=s;n.Delete=h}(XHR||(XHR={})),function(n){function e(n){i("EmailSubject",n.Subject);i("EmailDateReceived",n.DateReceived_ToString);i("EmailFrom",n.From);i("EmailTo",n.To);i("EmailCc",n.CC);var u=new DOMParser,f=u.parseFromString(n.Body,"text/html"),r=document.getElementById("EmailMessage");t(r);r.appendChild(f.documentElement);o(n.Attachments)}function o(n){var e=document.getElementById("EmailAttachments"),r,u,f,i;for(t(e),r=0,u=n;r<u.length;r++)f=u[r],i=document.createElement("a"),i.style.marginRight="1em",i.href=f.URL,i.appendChild(document.createTextNode(f.Filename)),e.appendChild(i)}function i(n,i){var r=document.getElementById(n);t(r);r.appendChild(document.createTextNode(i))}function s(i){var r=n.mailboxes.filter(function(n){return n.MailboxName===i}),u=document.getElementById("MailboxName");t(u);r.length===1&&u.appendChild(document.createTextNode(r[0].Name))}function f(){var n=document.getElementById("EmailList");return t(n),n}function h(){for(var u,t,c,l,a,e,i,v=f(),s=document.createDocumentFragment(),o=0,h=n.currentEmailList;o<h.length;o++)u=h[o],t=document.createElement("div"),t.classList.add("d-flex"),t.classList.add("col-12"),t.classList.add("flex-row"),t.classList.add("EmailDataRow"),t.classList.add("flex-wrap"),c=r("3",u.DateReceived_ToString),t.appendChild(c),l=r("3",u.From),t.appendChild(l),a=r("4",u.Subject),t.appendChild(a),e=r("2",""),e.classList.add("CenterButton"),i=document.createElement("a"),i.href="#"+n.currentHash.AddEmailId(u.Id),i.classList.add("btn"),i.classList.add("btn-info"),i.classList.add("MyInfoButton"),i.appendChild(document.createTextNode("View")),e.appendChild(i),t.appendChild(e),s.appendChild(t);v.appendChild(s)}function r(n,t){var i=document.createElement("div");return i.classList.add("col-"+n),i.classList.add("EmailDataCell"),t.length>0&&i.appendChild(document.createTextNode(t)),i}function c(){for(var t,f=document.getElementById("Commissioners"),e=document.getElementById("FormerCommissioners"),o=document.getElementById("OtherPublic"),i=0,r=n.mailboxes;i<r.length;i++)t=r[i],t.Active===0?t.Title.indexOf("ommiss")!==-1?e.appendChild(u(t.MailboxName,t.Name,t.Title)):o.appendChild(u(t.MailboxName,t.Name,t.Title)):f.appendChild(u(t.MailboxName,t.Name,t.Title));document.getElementById("MailboxList").style.display="block"}function u(n,t,i){var r=document.createElement("li"),u,f;return r.classList.add("d-flex"),r.classList.add("col-sm-6"),r.classList.add("col-xl-4"),r.classList.add("col-xs-12"),u=document.createElement("span"),u.style.marginRight="1em",u.appendChild(document.createTextNode(i.replace("Commissioner of ","").replace("Former",""))),r.appendChild(u),f=document.createElement("a"),f.href="#mailbox="+n+"&page=1",f.appendChild(document.createTextNode(t)),r.appendChild(f),r}function t(n){while(n.firstChild)n.removeChild(n.firstChild)}function l(n){var t=document.getElementById(n);t.style.display="block"}function a(n){var t=document.getElementById(n);t.style.display="none"}n.BuildEmailView=e;n.UpdateMailboxName=s;n.ClearEmailList=f;n.BuildEmailList=h;n.BuildMailboxes=c;n.BuildMailboxItem=u;n.clearElement=t;n.Show=l;n.Hide=a}(CoMail||(CoMail={})),function(n){function u(){window.onhashchange=t;l()}function f(){location.hash=n.currentHash.RemoveEmailId();var t=document.getElementById("EmailMessage");n.clearElement(t)}function t(){i()}function i(){var i=location.hash,t=n.currentHash;n.currentHash=new n.LocationHash(location.hash.substring(1));e(n.currentHash,t)}function e(t,i){t.Mailbox.length===0?(n.Show("MailboxList"),n.ClearEmailList(),n.Hide("MailboxView")):((i===null||i.Mailbox!==t.Mailbox||i.Page!==t.Page)&&(n.UpdateMailboxName(t.Mailbox),s(n.currentHash),h(n.currentHash)),n.Hide("MailboxList"),n.Show("MailboxView"));t.EmailId>-1&&o(t.EmailId)}function o(t){n.Show("Loading");var i=new n.Email;i.Get(t).then(function(t){n.BuildEmailView(t);$("#EmailView").modal("show");n.Hide("Loading")},function(){console.log("error getting Email");n.Hide("EmailLoading")})}function s(t){var i,r;n.Show("Loading");i=document.getElementById("EmailList");n.clearElement(i);r=new n.Email;r.GetList(t).then(function(t){n.currentEmailList=t;n.BuildEmailList();n.Hide("Loading")},function(){console.log("error getting Email List");n.Hide("Loading")})}function h(t){var i=new n.Email;i.GetCount(t).then(function(t){n.currentEmailCount=t;console.log("current email count",n.currentEmailCount);c()},function(){console.log("error getting Email Count")})}function c(){var u=document.getElementById("TotalPageCount"),t,i,f;n.clearElement(u);t=Math.max(Math.floor(n.currentEmailCount/20),1);u.appendChild(document.createTextNode("Page "+n.currentHash.Page+" of "+t));i=document.getElementById("PreviousPage");i.href=location.hash;r(i,n.currentHash.Page-1,t);f=document.getElementById("NextPage");r(f,n.currentHash.Page+1,t)}function r(t,i,r){t.href=location.hash;i<r&&i>0&&(t.href.indexOf("page=")>-1?t.href=t.href.replace("page="+n.currentHash.Page,"page="+i):t.href+="&page="+i)}function l(){var t=new n.PublicMailBox;t.Get().then(function(t){n.mailboxes=t;n.BuildMailboxes();n.Hide("Loading");location.hash.substring(1).length>0&&i()},function(){console.log("error getting All Mailboxes")})}n.mailboxes=[];n.currentEmailList=[];n.currentHash=null;n.Start=u;n.ModalClosed=f;n.HashChange=t}(CoMail||(CoMail={}));